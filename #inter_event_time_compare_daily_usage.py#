#from inter_event_time_analysis import get_traces
from inter_event_time_analysis_activities import get_activities_inter_times
from inter_event_time_analysis import make_block_usage
from inter_event_time_by_url_analysis import get_filtered_traces


def compare_daily_activity():

    traces = get_filtered_traces()
    act_beg, act_end = get_activities_inter_times()

    for user_mix, blocks_beg in act_beg.items():
        for user_traces, row in traces.items():
            #get same user
            if user_mix == user_traces:
                print user_mix
                traces_beg, traces_end = make_block_usage(sorted(traces[user_traces]), 60*10)







def get_matching_nonmatching_time(traces_beg, traces_end, act_beg, act_end):

    cont_traces = 0
    cont_act = 0
    match_time = 0
    non_match_time = 0
    first_daytime = min(act_beg[0], traces_beg[0]))
    last_daytime = max(act_end[len(act_end)-1], traces_end[len(traces_end)-1])
    first_date = first_daytime.date()
    last_date = last_daytime.date()
    current_date = first_day
    curr_act_date_index = 0
    curr_trac_date_index = 0

    while current_date <= last_date:
        t_beg_curr_date = get_beginning_of_day_time(current_date, traces_beg)
        a_beg_curr_date = get_beginning_of_day_time(current_date, act_beg)

        #match until beginning of day
        if t_beg_curr_date.date() != datetime.datetime.now().date() or a_beg_curr_date.date() != datetime.datetime.now().date():
            match_time += min(a_beg_curr_day.time().total_seconds(), t_beg_curr_day.time().total_seconds())
        #no interaction on both
        else:
            match_time += 24*60*60

        #get matches for the middle of the day
        j = curr_trac_date_index
        for i in range (curr_act_date_index,act_beg):
            #no intersection
            if act_end[i] < traces_beg[j]:
                non_match_time += act_end[i] - act_beg[i]
            

        current_date = current_date + datetime.timedelta(days=1)

    for i in range(0,len(act_beg)):
        a_beg = act_beg[i]
        current_date = a_beg.date()
        #t_beg = traces_beg[cont_traces]
        t_beg_curr_day = get_beginning_of_day_time(current_date, t_beg)
        a_beg_curr_day = get_beginning_of_day_time(current_date, a_beg)
        match_time += min(a_beg_curr_day.time().total_seconds(), t_beg_curr_day.time().total_seconds())
        if a_beg.date() <= t_beg.date():


def get_beginning_of_day_time(date, timsts):

    for elem in timsts:
        if elem.date() == date:
            return elem
    return datetime.datetime.now()

if __name__ == "__main__":
    compare_daily_activity()
